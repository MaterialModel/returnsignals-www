---
// Header with logo, navigation, and CTA button
interface Props {
  ctaUrl?: string
}

const { ctaUrl = 'https://calendly.com/alejandro-materialmodel/return-signals-introductory-call' } =
  Astro.props

// Centralized navigation links
const navLinks = [
  { href: '/blog', label: 'Blog' },
  { href: '/security', label: 'Security' },
  { href: '/roi', label: 'ROI Calculator' },
]
---

<>
  <header
    id="main-header"
    class="fixed top-0 left-0 z-50 w-full bg-surface-base border-b border transition-transform duration-300 ease-in-out"
  >
    <div class="container-lg py-3 sm:py-4">
      <div class="flex items-center justify-between">
        <a href="/" class="inline-flex items-center gap-3">
          <img src="/images/logo/logo+txt-black.svg" alt="Return Signals" class="h-6 sm:h-7" />
        </a>

        <!-- Desktop Navigation -->
        <nav class="hidden md:flex items-center gap-6">
          {
            navLinks.map((link) => (
              <a
                href={link.href}
                class="text-secondary hover:text-primary font-medium transition-colors"
              >
                {link.label}
              </a>
            ))
          }
          <a href={ctaUrl} target="_blank" rel="noopener noreferrer" class="btn btn-primary btn-sm">
            Book a Demo
          </a>
        </nav>

        <!-- Mobile menu button -->
        <button
          id="mobile-menu-button"
          class="md:hidden relative z-50 p-2 text-primary focus:outline-none"
          aria-label="Toggle menu"
          aria-expanded="false"
        >
          <span class="sr-only">Toggle menu</span>
          <div class="w-6 h-6 relative flex items-center justify-center">
            <span
              class="menu-bar absolute block h-0.5 w-6 bg-primary rounded-full transition-all duration-300 ease-out"
              style="top: 5px"></span>
            <span
              class="menu-bar absolute block h-0.5 w-6 bg-primary rounded-full transition-all duration-300 ease-out"
              style="top: 11px"></span>
            <span
              class="menu-bar absolute block h-0.5 w-6 bg-primary rounded-full transition-all duration-300 ease-out"
              style="top: 17px"></span>
          </div>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile menu overlay -->
  <div id="mobile-menu-overlay" class="fixed inset-0 z-30 pointer-events-none md:hidden">
    <!-- Full screen menu -->
    <div
      id="mobile-menu"
      class="absolute inset-0 bg-surface-base transform translate-x-full transition-transform duration-300 ease-out"
    >
      <!-- Header -->
      <div class="flex items-center justify-between px-6 h-20">
        <a href="/" class="inline-flex items-center gap-3">
          <img src="/images/logo/logo+txt-black.svg" alt="Return Signals" class="h-6" />
        </a>
        <!-- Empty space where hamburger button would be (it's fixed in main header) -->
        <div class="w-10 h-10"></div>
      </div>

      <!-- Menu content -->
      <div class="flex flex-col h-[calc(100%-5rem)]">
        <!-- Navigation links - centered -->
        <nav class="flex-1 px-6 pt-10">
          <div class="space-y-1">
            <a
              href="/"
              class="mobile-menu-link flex items-center gap-3 px-3 py-3.5 text-lg text-primary hover:text-secondary hover:bg-surface-subtle rounded-lg transition-all group"
            >
              <svg
                class="w-6 h-6 text-secondary group-hover:text-primary transition-colors"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"
                ></path>
              </svg>
              <span>Home</span>
            </a>
            {
              navLinks.map((link) => (
                <a
                  href={link.href}
                  class="mobile-menu-link flex items-center gap-3 px-3 py-3.5 text-lg text-primary hover:text-secondary hover:bg-surface-subtle rounded-lg transition-all group"
                >
                  {link.href === '/blog' && (
                    <svg
                      class="w-6 h-6 text-secondary group-hover:text-primary transition-colors"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 0 1-2.25 2.25M16.5 7.5V18a2.25 2.25 0 0 0 2.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 0 0 2.25 2.25h13.5M6 7.5h3v3H6v-3Z"
                      />
                    </svg>
                  )}
                  {link.href === '/security' && (
                    <svg
                      class="w-6 h-6 text-secondary group-hover:text-primary transition-colors"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"
                      />
                    </svg>
                  )}
                  {link.href === '/roi' && (
                    <svg
                      class="w-6 h-6 text-secondary group-hover:text-primary transition-colors"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M15.75 15.75V18m-7.5-6.75h.008v.008H8.25v-.008Zm0 2.25h.008v.008H8.25V13.5Zm0 2.25h.008v.008H8.25v-.008Zm0 2.25h.008v.008H8.25V18Zm2.498-6.75h.007v.008h-.007v-.008Zm0 2.25h.007v.008h-.007V13.5Zm0 2.25h.007v.008h-.007v-.008Zm0 2.25h.007v.008h-.007V18Zm2.504-6.75h.008v.008h-.008v-.008ZM8.25 6h7.5v2.25h-7.5V6ZM12 2.25c-1.892 0-3.758.11-5.593.322C5.307 2.7 4.5 3.65 4.5 4.757V19.5a2.25 2.25 0 0 0 2.25 2.25h10.5a2.25 2.25 0 0 0 2.25-2.25V4.757c0-1.108-.806-2.057-1.907-2.185A48.507 48.507 0 0 0 12 2.25Z"
                      />
                    </svg>
                  )}
                  <span>{link.label}</span>
                </a>
              ))
            }
            <a
              href={ctaUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="mobile-menu-link flex items-center gap-3 px-3 py-3.5 text-lg text-primary hover:text-secondary hover:bg-surface-subtle rounded-lg transition-all group"
            >
              <svg
                class="w-6 h-6 text-secondary group-hover:text-primary transition-colors"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"
                ></path>
              </svg>
              <span>Book a Demo</span>
            </a>
          </div>
        </nav>
      </div>
    </div>
  </div>

  <!-- Spacer for fixed header -->
  <div class="h-[52px] sm:h-[60px]"></div>

  <style>
    /* Hamburger to X animation styles */
    .menu-open .menu-bar:nth-child(1) {
      transform: rotate(45deg);
      top: 11px !important;
    }

    .menu-open .menu-bar:nth-child(2) {
      opacity: 0;
      transform: translateX(-100%);
    }

    .menu-open .menu-bar:nth-child(3) {
      transform: rotate(-45deg);
      top: 11px !important;
    }
  </style>

  <script>
    const mobileMenuButton = document.getElementById('mobile-menu-button')
    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay')
    const mobileMenu = document.getElementById('mobile-menu')
    const menuButtonIcon = mobileMenuButton?.querySelector('div')

    let isOpen = false

    function openMenu() {
      if (!mobileMenuOverlay || !mobileMenu || !menuButtonIcon) return

      isOpen = true

      // Enable pointer events on overlay
      mobileMenuOverlay.classList.remove('pointer-events-none')

      // Animate menu elements
      requestAnimationFrame(() => {
        // Slide in menu panel
        mobileMenu.classList.remove('translate-x-full')
        mobileMenu.classList.add('translate-x-0')

        // Transform hamburger to X
        menuButtonIcon.classList.add('menu-open')
      })

      mobileMenuButton?.setAttribute('aria-expanded', 'true')
      document.body.style.overflow = 'hidden' // Prevent body scroll
    }

    function closeMenu() {
      if (!mobileMenuOverlay || !mobileMenu || !menuButtonIcon) return

      isOpen = false

      // Animate menu elements
      mobileMenu.classList.remove('translate-x-0')
      mobileMenu.classList.add('translate-x-full')
      menuButtonIcon.classList.remove('menu-open')

      // Disable pointer events after animation
      setTimeout(() => {
        mobileMenuOverlay?.classList.add('pointer-events-none')
      }, 300)

      mobileMenuButton?.setAttribute('aria-expanded', 'false')
      document.body.style.overflow = '' // Restore body scroll
    }

    // Toggle menu with hamburger button
    if (mobileMenuButton) {
      mobileMenuButton.addEventListener('click', () => {
        if (isOpen) {
          closeMenu()
        } else {
          openMenu()
        }
      })
    }

    // Close on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isOpen) {
        closeMenu()
      }
    })

    // Close menu when clicking on a link (except external links)
    document.querySelectorAll('.mobile-menu-link').forEach((link) => {
      if (!link.hasAttribute('target')) {
        link.addEventListener('click', () => {
          // Small delay to allow the link to register
          setTimeout(closeMenu, 100)
        })
      }
    })

    // Auto-hide header on scroll down, show on scroll up
    const header = document.getElementById('main-header')
    let lastScrollY = window.scrollY
    let ticking = false

    function updateHeaderVisibility() {
      const currentScrollY = window.scrollY

      // Always show header if mobile menu is open
      if (isOpen) {
        if (header) header.style.transform = 'translateY(0)'
        lastScrollY = currentScrollY
        ticking = false
        return
      }

      // Show header at top of page
      if (currentScrollY < 10) {
        if (header) header.style.transform = 'translateY(0)'
      }
      // Hide header when scrolling down (after 100px threshold)
      else if (currentScrollY > lastScrollY && currentScrollY > 100) {
        if (header) header.style.transform = 'translateY(-100%)'
      }
      // Show header when scrolling up
      else if (currentScrollY < lastScrollY) {
        if (header) header.style.transform = 'translateY(0)'
      }

      lastScrollY = currentScrollY
      ticking = false
    }

    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(updateHeaderVisibility)
        ticking = true
      }
    })
  </script>
</>
