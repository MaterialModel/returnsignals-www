---
import BaseLayout from "@layouts/BaseLayout.astro";
import Header from "@components/shared/Header.astro";
import Footer from "@components/shared/Footer.astro";
import FAQ from "@components/shared/FAQ.astro";
import CalculatorInput from "@components/calculator/CalculatorInput.astro";
import InputSection from "@components/calculator/InputSection.astro";
import ResultsPanel from "@components/calculator/ResultsPanel.astro";
import { formulas, inputVariables } from "@components/calculator/formulas";
import { roiFaqItems } from "@data/roi-faq";
---

<BaseLayout
  title="ROI Calculator - Return Signals"
  description="Calculate the potential ROI of reducing returns and improving customer retention with Return Signals"
>
  <!-- MathJax for formula rendering -->
  <script is:inline>
    window.MathJax = {
      tex: {
        inlineMath: [
          ["$", "$"],
          ["\\(", "\\)"],
        ],
        displayMath: [
          ["$$", "$$"],
          ["\\[", "\\]"],
        ],
      },
      options: {
        ignoreHtmlClass: "mathjax-ignore",
      },
      svg: {
        fontCache: "global",
      },
    };
  </script>
  <script
    is:inline
    id="MathJax-script"
    async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <Header />

  <main id="main-content">
    <!-- Hero Section -->
    <section class="py-12 sm:py-16">
      <div class="container-lg">
        <div class="text-center animate-on-scroll">
          <span class="eyebrow">Financial Impact</span>
          <h1 class="page-title mt-4 mb-6">ROI Calculator</h1>
          <p class="section-description max-w-3xl mx-auto">
            See how Return Signals can impact your bottom line by reducing
            returns, increasing exchanges, and improving customer retention.
          </p>
          <!-- Moved formula link near controls below -->
        </div>
      </div>
    </section>

    <!-- Calculator Section -->
    <section class="pb-20 sm:pb-32">
      <div class="container-narrow">
        <!-- Control Bar -->
        <div class="control-bar">
          <!-- Simplified/Full Toggle -->
          <div class="segmented" role="group" aria-label="Mode">
            <button
              id="simplifiedToggle"
              class="segmented-btn bg-accent-primary text-inverse"
              aria-pressed="true"
            >
              Simplified
            </button>
            <button
              id="fullToggle"
              class="segmented-btn text-secondary hover:text-primary"
              aria-pressed="false"
            >
              Full
            </button>
          </div>

          <!-- Monthly/Annual Toggle -->
          <div class="segmented" role="group" aria-label="Period">
            <button
              id="monthlyToggle"
              class="segmented-btn text-secondary hover:text-primary"
              aria-pressed="false"
            >
              Monthly
            </button>
            <button
              id="annualToggle"
              class="segmented-btn bg-accent-primary text-inverse"
              aria-pressed="true"
            >
              Annual
            </button>
          </div>
          <!-- Formula link placed alongside toggles -->
          <a href="#methodology" class="toolbar-link">
            <svg
              class="w-4 h-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z"
              ></path>
            </svg>
            <span class="underline underline-offset-2"
              >Learn how we calculate ROI</span
            >
          </a>
        </div>

        <div class="grid md:grid-cols-2 gap-8 lg:gap-12">
          <!-- Input Form -->
          <div class="space-y-8">
            <InputSection title="Business Metrics">
              <CalculatorInput
                id="unitsSold"
                label="Monthly Ecomm Units Sold (before returns)"
                value="30000"
                min="0"
              />
              <CalculatorInput
                id="avgRevenue"
                label="Average Unit Revenue ($)"
                value="200"
                min="0"
                step="0.01"
              />
              <CalculatorInput
                id="avgCost"
                label="Average Unit Cost ($)"
                value="70"
                min="0"
                step="0.01"
              />
              <CalculatorInput
                id="unitsPerOrder"
                label="Average Units Per Order"
                value="1.7"
                min="0.1"
                step="0.1"
                wrapperId="input-unitsPerOrder"
              />
              <CalculatorInput
                id="orderShippingCost"
                label="Outbound Shipping Cost per Order ($)"
                value="10"
                min="0"
                step="0.01"
                wrapperId="input-orderShippingCost"
              />
              <CalculatorInput
                id="returnCost"
                label="Return Processing Cost per Unit ($)"
                value="20"
                min="0"
                step="0.01"
                wrapperId="input-returnCost"
              />
            </InputSection>

            <InputSection title="Return Rates">
              <CalculatorInput
                id="fitReturnRate"
                label="Fit-Related Return Rate (%)"
                value="12"
                min="0"
                max="100"
                step="0.1"
              />
              <CalculatorInput
                id="otherReturnRate"
                label="Other Return Rate (%)"
                value="18"
                min="0"
                max="100"
                step="0.1"
              />
              <CalculatorInput
                id="multisizeFit"
                label="Multi-size Fit Orders (%)"
                value="25"
                min="0"
                max="100"
                step="0.1"
                helpText="Orders with multiple sizes where all but one are returned"
              />
              <CalculatorInput
                id="resaleProbability"
                label="Returned Unit Resale Probability (%)"
                value="30"
                min="0"
                max="100"
                step="0.1"
                wrapperId="input-resaleProbability"
              />
            </InputSection>

            <InputSection
              title="Return Signals Impact"
              id="section-returnSignalsImpact"
            >
              <CalculatorInput
                id="engagementRate"
                label="Customer Engagement Rate (%)"
                value="40"
                min="0"
                max="100"
                step="0.1"
                helpText="Percentage of customers with problems who engage with Return Signals"
              />
              <CalculatorInput
                id="exchangeLift"
                label="Return → Exchange Lift (%)"
                value="40"
                min="0"
                max="100"
                step="0.1"
              />
              <CalculatorInput
                id="keepLift"
                label="Return → Keep Item Lift (%)"
                value="10"
                min="0"
                max="100"
                step="0.1"
              />
              <CalculatorInput
                id="retentionLift"
                label="180-day Retention Lift (%)"
                value="20"
                min="0"
                max="100"
                step="0.1"
                helpText="Lift in repeat purchases for customers for whom we resolved their problem"
              />
            </InputSection>

            <InputSection title="Marketing Costs" id="section-marketingCosts">
              <CalculatorInput
                id="repeatMarketingCost"
                label="Repeat Customer Marketing Cost ($)"
                value="0"
                min="0"
                step="0.01"
                helpText="Cost to acquire a repeat order from existing customers"
              />
            </InputSection>
          </div>

          <!-- Results Panel -->
          <ResultsPanel />
        </div>
      </div>
    </section>

    <!-- Methodology Section -->
    <section id="methodology" class="py-16 sm:py-20 bg-surface-subtle">
      <div class="container-narrow">
        <div class="text-center mb-12">
          <h2 class="text-2xl sm:text-3xl font-bold text-primary mb-4">
            How We Calculate ROI
          </h2>
          <p class="text-secondary max-w-2xl mx-auto">
            Our calculator uses a transparent methodology based on your business
            metrics to estimate the financial impact of reducing returns and
            improving customer retention.
          </p>
        </div>

        <!-- Input Variables Section -->
        <div class="bg-surface-base border border-border rounded-lg p-6 mb-8">
          <h3 class="text-lg font-semibold text-primary mb-4">
            Input Variables
          </h3>
          <p class="text-sm text-secondary mb-6">
            These are the values you enter in the calculator. Understanding them
            helps interpret the results.
          </p>

          <div class="grid md:grid-cols-2 gap-6">
            <!-- Business Metrics -->
            <div>
              <h4 class="text-sm font-semibold text-accent-primary mb-3">
                Business Metrics
              </h4>
              <div class="space-y-2 text-sm">
                {
                  inputVariables.businessMetrics.map((v) => (
                    <div class="flex items-baseline gap-2">
                      <span
                        class="font-mono text-accent-primary font-semibold min-w-[50px]"
                        set:html={v.html}
                      />
                      <span class="text-secondary">{v.description}</span>
                    </div>
                  ))
                }
              </div>
            </div>

            <!-- Costs -->
            <div>
              <h4 class="text-sm font-semibold text-accent-primary mb-3">
                Costs
              </h4>
              <div class="space-y-2 text-sm">
                {
                  inputVariables.costs.map((v) => (
                    <div class="flex items-baseline gap-2">
                      <span
                        class="font-mono text-accent-primary font-semibold min-w-[50px]"
                        set:html={v.html}
                      />
                      {v.descriptionHtml ? (
                        <span
                          class="text-secondary"
                          set:html={v.descriptionHtml}
                        />
                      ) : (
                        <span class="text-secondary">{v.description}</span>
                      )}
                    </div>
                  ))
                }
              </div>
            </div>

            <!-- Return Rates -->
            <div>
              <h4 class="text-sm font-semibold text-accent-primary mb-3">
                Return Rates
              </h4>
              <div class="space-y-2 text-sm">
                {
                  inputVariables.returnRates.map((v) => (
                    <div class="flex items-baseline gap-2">
                      <span
                        class="font-mono text-accent-primary font-semibold min-w-[50px]"
                        set:html={v.html}
                      />
                      <span class="text-secondary">{v.description}</span>
                    </div>
                  ))
                }
              </div>
            </div>

            <!-- Impact Metrics -->
            <div>
              <h4 class="text-sm font-semibold text-accent-primary mb-3">
                Return Signals Impact
              </h4>
              <div class="space-y-2 text-sm">
                {
                  inputVariables.impact.map((v) => (
                    <div class="flex items-baseline gap-2">
                      <span
                        class="font-mono text-accent-primary font-semibold min-w-[50px]"
                        set:html={v.html}
                      />
                      <span class="text-secondary">{v.description}</span>
                    </div>
                  ))
                }
              </div>
            </div>
          </div>
        </div>

        <!-- Formula Steps -->
        <div class="space-y-6" id="formulaContent">
          <!-- Step 1: Eligible Returns -->
          <div class="bg-surface-base border border-border rounded-lg p-6">
            <h3 class="text-lg font-semibold text-primary mb-2">
              {formulas.eligibleReturns.title}
            </h3>
            <p class="text-sm text-secondary mb-4">
              {formulas.eligibleReturns.description}
            </p>

            <div class="bg-surface-subtle p-4 rounded-lg mb-4">
              <div
                class="text-base"
                set:html={`\\[${formulas.eligibleReturns.mainFormula}\\]`}
              />
            </div>

            <div class="space-y-2 text-sm text-secondary mb-4">
              <p class="font-medium text-primary">Where:</p>
              {
                formulas.eligibleReturns.subFormulas.map((sf) => (
                  <div class="ml-4 flex flex-col gap-1">
                    <span set:html={`\\(${sf.latex}\\)`} />
                    <span class="text-tertiary text-xs ml-4">
                      {sf.description}
                    </span>
                  </div>
                ))
              }
            </div>

            <div
              class="bg-accent-primary/5 border-l-2 border-accent-primary p-3 rounded-r"
            >
              <p class="text-sm text-secondary italic">
                <strong class="text-primary not-italic">Why?</strong>
                {formulas.eligibleReturns.intuition}
              </p>
            </div>
          </div>

          <!-- Step 2: Exchange Value -->
          <div class="bg-surface-base border border-border rounded-lg p-6">
            <h3 class="text-lg font-semibold text-primary mb-2">
              {formulas.exchangeValue.title}
            </h3>
            <p class="text-sm text-secondary mb-4">
              {formulas.exchangeValue.description}
            </p>

            <div class="bg-surface-subtle p-4 rounded-lg mb-4">
              <div
                class="text-base"
                set:html={`\\[${formulas.exchangeValue.mainFormula}\\]`}
              />
            </div>

            <div class="space-y-2 text-sm text-secondary mb-4">
              <p class="font-medium text-primary">Where:</p>
              {
                formulas.exchangeValue.subFormulas.map((sf) => (
                  <div class="ml-4 flex flex-col gap-1">
                    <span set:html={`\\(${sf.latex}\\)`} />
                    <span class="text-tertiary text-xs ml-4">
                      {sf.description}
                    </span>
                  </div>
                ))
              }
            </div>

            <div
              class="bg-accent-primary/5 border-l-2 border-accent-primary p-3 rounded-r"
            >
              <p class="text-sm text-secondary mb-2">
                <strong class="text-primary">Why this formula works:</strong>
              </p>
              <ul class="text-sm text-secondary space-y-1 ml-4">
                {
                  formulas.exchangeValue.intuitionBulletsHtml?.map((bullet) => (
                    <li class="flex items-start gap-2">
                      <span class="text-accent-primary">+</span>
                      <span set:html={bullet} />
                    </li>
                  ))
                }
              </ul>
            </div>
          </div>

          <!-- Step 3: Keep Item Value -->
          <div class="bg-surface-base border border-border rounded-lg p-6">
            <h3 class="text-lg font-semibold text-primary mb-2">
              {formulas.keepValue.title}
            </h3>
            <p class="text-sm text-secondary mb-4">
              {formulas.keepValue.description}
            </p>

            <div class="bg-surface-subtle p-4 rounded-lg mb-4">
              <div
                class="text-base"
                set:html={`\\[${formulas.keepValue.mainFormula}\\]`}
              />
            </div>

            <div class="space-y-2 text-sm text-secondary mb-4">
              <p class="font-medium text-primary">Where:</p>
              {
                formulas.keepValue.subFormulas.map((sf) => (
                  <div class="ml-4 flex flex-col gap-1">
                    <span set:html={`\\(${sf.latex}\\)`} />
                    <span class="text-tertiary text-xs ml-4">
                      {sf.description}
                    </span>
                  </div>
                ))
              }
            </div>

            <div
              class="bg-accent-primary/5 border-l-2 border-accent-primary p-3 rounded-r"
            >
              <p class="text-sm text-secondary mb-2">
                <strong class="text-primary">Why this formula works:</strong>
              </p>
              <ul class="text-sm text-secondary space-y-1 ml-4">
                {
                  formulas.keepValue.intuitionBulletsHtml?.map((bullet) => (
                    <li class="flex items-start gap-2">
                      <span class="text-accent-primary">+</span>
                      <span set:html={bullet} />
                    </li>
                  ))
                }
              </ul>
            </div>
          </div>

          <!-- Step 4: Retention Value -->
          <div class="bg-surface-base border border-border rounded-lg p-6">
            <h3 class="text-lg font-semibold text-primary mb-2">
              {formulas.retentionValue.title}
            </h3>
            <p class="text-sm text-secondary mb-4">
              {formulas.retentionValue.description}
            </p>

            <div class="bg-surface-subtle p-4 rounded-lg mb-4">
              <div
                class="text-base"
                set:html={`\\[${formulas.retentionValue.mainFormula}\\]`}
              />
            </div>

            <div class="space-y-2 text-sm text-secondary mb-4">
              <p class="font-medium text-primary">Where:</p>
              {
                formulas.retentionValue.subFormulas.map((sf) => (
                  <div class="ml-4 flex flex-col gap-1">
                    <span set:html={`\\(${sf.latex}\\)`} />
                    <span class="text-tertiary text-xs ml-4">
                      {sf.description}
                    </span>
                  </div>
                ))
              }
            </div>

            <div
              class="bg-accent-primary/5 border-l-2 border-accent-primary p-3 rounded-r"
            >
              <p class="text-sm text-secondary mb-2">
                <strong class="text-primary">Why this formula works:</strong>
              </p>
              <ul class="text-sm text-secondary space-y-1 ml-4">
                {
                  formulas.retentionValue.intuitionBulletsHtml?.map(
                    (bullet) => (
                      <li class="flex items-start gap-2">
                        <span class="text-accent-primary">+</span>
                        <span set:html={bullet} />
                      </li>
                    ),
                  )
                }
              </ul>
            </div>
          </div>

          <!-- Total Value -->
          <div
            class="bg-accent-success-subtle border border-accent-success/20 p-6 rounded-lg"
          >
            <h3 class="text-lg font-semibold text-primary mb-3">
              {formulas.totalValue.title}
            </h3>
            <div
              class="text-base mb-2"
              set:html={`\\[${formulas.totalValue.formula}\\]`}
            />
            <p class="text-sm text-secondary">
              {formulas.totalValue.description}
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ Section -->
    <FAQ
      items={roiFaqItems}
      description="Common questions about e-commerce returns, their costs, and how to measure ROI on returns management."
    />
  </main>

  <Footer />
</BaseLayout>

<!-- Schema Markup -->
<script type="application/ld+json" is:inline>
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Return Signals ROI Calculator",
    "description": "Calculate the potential ROI of reducing returns and improving customer retention with Return Signals. Estimate savings from converting refunds to exchanges, preventing returns, and increasing repeat purchases.",
    "url": "https://www.returnsignals.com/roi",
    "applicationCategory": "BusinessApplication",
    "operatingSystem": "Any",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "provider": {
      "@type": "Organization",
      "name": "Return Signals",
      "url": "https://www.returnsignals.com"
    }
  }
</script>

<style>
  .card {
    @apply bg-surface-base border border-border rounded-lg p-6;
  }
  .control-bar {
    @apply flex flex-wrap items-center justify-center gap-8 lg:gap-12 mb-8;
  }
  .segmented {
    @apply inline-flex items-center rounded-full border border-border bg-surface-base p-0.5 shadow-sm;
  }
  .segmented-btn {
    @apply px-3 py-1.5 text-sm font-medium rounded-full transition-colors;
  }
  .toolbar-link {
    @apply inline-flex items-center gap-2 text-sm text-accent-primary hover:text-accent-hover transition-colors ml-2;
  }
</style>

<script>
  import "@utils/scroll-animations";
  import {
    calculateROI,
    formatCurrency,
    formatNumber,
    type CalculationInputs,
  } from "@components/calculator/CalculatorCore";

  // Get all input elements
  const inputs = {
    unitsSold: document.getElementById("unitsSold") as HTMLInputElement,
    avgRevenue: document.getElementById("avgRevenue") as HTMLInputElement,
    avgCost: document.getElementById("avgCost") as HTMLInputElement,
    unitsPerOrder: document.getElementById("unitsPerOrder") as HTMLInputElement,
    orderShippingCost: document.getElementById(
      "orderShippingCost",
    ) as HTMLInputElement,
    returnCost: document.getElementById("returnCost") as HTMLInputElement,
    fitReturnRate: document.getElementById("fitReturnRate") as HTMLInputElement,
    otherReturnRate: document.getElementById(
      "otherReturnRate",
    ) as HTMLInputElement,
    multisizeFit: document.getElementById("multisizeFit") as HTMLInputElement,
    resaleProbability: document.getElementById(
      "resaleProbability",
    ) as HTMLInputElement,
    engagementRate: document.getElementById(
      "engagementRate",
    ) as HTMLInputElement,
    exchangeLift: document.getElementById("exchangeLift") as HTMLInputElement,
    keepLift: document.getElementById("keepLift") as HTMLInputElement,
    retentionLift: document.getElementById("retentionLift") as HTMLInputElement,
    repeatMarketingCost: document.getElementById(
      "repeatMarketingCost",
    ) as HTMLInputElement,
  };

  // Get output elements
  const outputs = {
    displayValue: document.getElementById("displayValue"),
    exchangeValue: document.getElementById("exchangeValue"),
    keepValue: document.getElementById("keepValue"),
    retentionValue: document.getElementById("retentionValue"),
    eligibleReturns: document.getElementById("eligibleReturns"),
    engagedCustomers: document.getElementById("engagedCustomers"),
    resolvedCustomers: document.getElementById("resolvedCustomers"),
    returnsPrevented: document.getElementById("returnsPrevented"),
    baselineRevenue: document.getElementById("baselineRevenue"),
    marginExpansion: document.getElementById("marginExpansion"),
    profitLabel: document.getElementById("profitLabel"),
    baselineLabel: document.getElementById("baselineLabel"),
  };

  // Get toggle buttons
  const monthlyToggle = document.getElementById("monthlyToggle");
  const annualToggle = document.getElementById("annualToggle");
  const simplifiedToggle = document.getElementById("simplifiedToggle");
  const fullToggle = document.getElementById("fullToggle");

  // Toggle state
  let isAnnual = true;

  // Stored calculation values
  let calculationData = {
    monthly: 0,
    annual: 0,
    baselineMonthly: 0,
    baselineAnnual: 0,
    exchangeValue: 0,
    keepValue: 0,
    retentionValue: 0,
    eligibleReturns: 0,
    engagedCustomers: 0,
    returnsPrevented: 0,
  };

  function runCalculation() {
    // Gather inputs
    const inputValues: CalculationInputs = {
      unitsSold: parseFloat(inputs.unitsSold.value) || 0,
      avgRevenue: parseFloat(inputs.avgRevenue.value) || 0,
      avgCost: parseFloat(inputs.avgCost.value) || 0,
      unitsPerOrder: parseFloat(inputs.unitsPerOrder.value) || 1,
      orderShippingCost: parseFloat(inputs.orderShippingCost.value) || 0,
      returnCost: parseFloat(inputs.returnCost.value) || 0,
      fitReturnRate: parseFloat(inputs.fitReturnRate.value) || 0,
      otherReturnRate: parseFloat(inputs.otherReturnRate.value) || 0,
      multisizeFit: parseFloat(inputs.multisizeFit.value) || 0,
      resaleProbability: parseFloat(inputs.resaleProbability.value) || 0,
      engagementRate: parseFloat(inputs.engagementRate.value) || 0,
      exchangeLift: parseFloat(inputs.exchangeLift.value) || 0,
      keepLift: parseFloat(inputs.keepLift.value) || 0,
      retentionLift: parseFloat(inputs.retentionLift.value) || 0,
      repeatMarketingCost: parseFloat(inputs.repeatMarketingCost.value) || 0,
    };

    // Calculate results
    const results = calculateROI(inputValues);

    // Store for toggle
    calculationData = {
      monthly: results.totalMonthly,
      annual: results.totalAnnual,
      baselineMonthly: results.baselineMonthly,
      baselineAnnual: results.baselineAnnual,
      exchangeValue: results.exchangeValue,
      keepValue: results.keepValue,
      retentionValue: results.retentionValue,
      eligibleReturns: results.eligibleReturns,
      engagedCustomers: results.engagedCustomers,
      returnsPrevented: results.returnsPrevented,
    };

    // Update non-toggled outputs (margin expansion stays the same)
    if (outputs.marginExpansion)
      outputs.marginExpansion.textContent =
        results.marginExpansionPct.toFixed(1) + "%";

    // Update display based on current toggle state
    updateDisplay();
  }

  function updateDisplay() {
    const multiplier = isAnnual ? 12 : 1;

    if (isAnnual) {
      if (outputs.profitLabel)
        outputs.profitLabel.textContent = "Annual Profit Increase";
      if (outputs.baselineLabel)
        outputs.baselineLabel.textContent = "Baseline Annual Net Sales";
      if (outputs.displayValue)
        outputs.displayValue.textContent = formatCurrency(
          calculationData.annual,
        );
      if (outputs.baselineRevenue)
        outputs.baselineRevenue.textContent = formatCurrency(
          calculationData.baselineAnnual,
        );
    } else {
      if (outputs.profitLabel)
        outputs.profitLabel.textContent = "Monthly Profit Increase";
      if (outputs.baselineLabel)
        outputs.baselineLabel.textContent = "Baseline Monthly Net Sales";
      if (outputs.displayValue)
        outputs.displayValue.textContent = formatCurrency(
          calculationData.monthly,
        );
      if (outputs.baselineRevenue)
        outputs.baselineRevenue.textContent = formatCurrency(
          calculationData.baselineMonthly,
        );
    }

    // Update breakdown values based on toggle
    if (outputs.exchangeValue)
      outputs.exchangeValue.textContent = formatCurrency(
        calculationData.exchangeValue * multiplier,
      );
    if (outputs.keepValue)
      outputs.keepValue.textContent = formatCurrency(
        calculationData.keepValue * multiplier,
      );
    if (outputs.retentionValue)
      outputs.retentionValue.textContent = formatCurrency(
        calculationData.retentionValue * multiplier,
      );

    // Update other metrics based on toggle
    if (outputs.eligibleReturns)
      outputs.eligibleReturns.textContent = formatNumber(
        calculationData.eligibleReturns * multiplier,
      );
    if (outputs.engagedCustomers)
      outputs.engagedCustomers.textContent = formatNumber(
        calculationData.engagedCustomers * multiplier,
      );
    if (outputs.returnsPrevented)
      outputs.returnsPrevented.textContent = formatNumber(
        calculationData.returnsPrevented * multiplier,
      );
  }

  function setToggleState(annual: boolean) {
    isAnnual = annual;

    if (monthlyToggle && annualToggle) {
      if (annual) {
        monthlyToggle.classList.remove("bg-accent-primary", "text-inverse");
        monthlyToggle.classList.add("text-secondary", "hover:text-primary");
        annualToggle.classList.add("bg-accent-primary", "text-inverse");
        annualToggle.classList.remove("text-secondary", "hover:text-primary");
        monthlyToggle.setAttribute("aria-pressed", "false");
        annualToggle.setAttribute("aria-pressed", "true");
      } else {
        annualToggle.classList.remove("bg-accent-primary", "text-inverse");
        annualToggle.classList.add("text-secondary", "hover:text-primary");
        monthlyToggle.classList.add("bg-accent-primary", "text-inverse");
        monthlyToggle.classList.remove("text-secondary", "hover:text-primary");
        annualToggle.setAttribute("aria-pressed", "false");
        monthlyToggle.setAttribute("aria-pressed", "true");
      }
    }

    updateDisplay();
  }

  // Elements to hide in simplified mode
  const simplifiedHiddenElements = [
    document.getElementById("input-unitsPerOrder"),
    document.getElementById("input-orderShippingCost"),
    document.getElementById("input-returnCost"),
    document.getElementById("input-resaleProbability"),
    document.getElementById("section-returnSignalsImpact"),
    document.getElementById("section-marketingCosts"),
  ];

  function setModeState(simplified: boolean) {
    if (simplifiedToggle && fullToggle) {
      if (simplified) {
        fullToggle.classList.remove("bg-accent-primary", "text-inverse");
        fullToggle.classList.add("text-secondary", "hover:text-primary");
        simplifiedToggle.classList.add("bg-accent-primary", "text-inverse");
        simplifiedToggle.classList.remove(
          "text-secondary",
          "hover:text-primary",
        );
        fullToggle.setAttribute("aria-pressed", "false");
        simplifiedToggle.setAttribute("aria-pressed", "true");
      } else {
        simplifiedToggle.classList.remove("bg-accent-primary", "text-inverse");
        simplifiedToggle.classList.add("text-secondary", "hover:text-primary");
        fullToggle.classList.add("bg-accent-primary", "text-inverse");
        fullToggle.classList.remove("text-secondary", "hover:text-primary");
        simplifiedToggle.setAttribute("aria-pressed", "false");
        fullToggle.setAttribute("aria-pressed", "true");
      }
    }

    // Show/hide elements
    simplifiedHiddenElements.forEach((el) => {
      if (el) el.classList.toggle("hidden", simplified);
    });
  }

  // Add event listeners to all inputs
  Object.values(inputs).forEach((input) => {
    if (input) {
      input.addEventListener("input", runCalculation);
    }
  });

  // Add toggle event listeners
  if (monthlyToggle) {
    monthlyToggle.addEventListener("click", () => setToggleState(false));
  }
  if (annualToggle) {
    annualToggle.addEventListener("click", () => setToggleState(true));
  }
  if (simplifiedToggle) {
    simplifiedToggle.addEventListener("click", () => setModeState(true));
  }
  if (fullToggle) {
    fullToggle.addEventListener("click", () => setModeState(false));
  }

  // Calculate initial values
  runCalculation();

  // Initialize simplified mode (hide advanced inputs)
  setModeState(true);
</script>
