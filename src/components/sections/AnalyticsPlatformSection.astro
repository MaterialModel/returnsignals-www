---
/**
 * Analytics Platform Section
 *
 * Main orchestrator for the analytics platform demo
 * Manages navigation and view switching between 5 sections
 */

import OverviewView from "@components/analytics/OverviewView.astro";
import InterventionsView from "@components/analytics/InterventionsView.astro";
import ProductsView from "@components/analytics/ProductsView.astro";
import ConfigurationView from "@components/analytics/ConfigurationView.astro";

interface Props {
  className?: string;
}

const { className = "" } = Astro.props;
---

<section class={`bg-surface-subtle ${className}`}>
  <div class="container-lg py-20 sm:py-32">
    <div class="text-center mb-12 animate-on-scroll">
      <h2 class="section-title mb-6">
        Turn customer signals into actionable insights
      </h2>
      <p class="section-description max-w-3xl mx-auto">
        Our analytics dashboard surfaces patterns in returns, complaints, and
        customer behavior, helping you reduce costs and improve products.
      </p>
    </div>

    <div
      class="analytics-platform-section animate-on-scroll"
      role="region"
      aria-label="Return Signals analytics platform demo"
    >
      <!-- Analytics Container -->
      <div
        class="analytics-container mx-auto max-w-[1100px] bg-surface-base border border-border rounded-xl shadow-2xl overflow-hidden relative"
      >
        <!-- Onboarding Overlay (closeable) - inside container -->
        <div
          class="onboarding-overlay absolute inset-0 bg-black/40 z-50 pointer-events-none rounded-xl"
          id="analytics-onboarding"
        >
          <!-- Desktop: Arrow to sidebar -->
          <div
            class="hidden sm:block absolute left-52 top-1/4 pointer-events-auto"
          >
            <div class="bg-white rounded-xl shadow-2xl p-6 max-w-xs relative">
              <div class="text-center mb-4">
                <div
                  class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-accent-primary/10 mb-3"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 text-accent-primary"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                  </svg>
                </div>
                <h3 class="text-lg font-semibold text-primary mb-2">
                  Explore sections
                </h3>
                <p class="text-sm text-secondary leading-relaxed mb-4">
                  Click the navigation items to view different sections
                </p>
                <button class="close-onboarding btn btn-primary w-full"
                  >Got it</button
                >
              </div>
              <!-- Arrow pointing left -->
              <div class="absolute right-full top-10 mr-3">
                <svg width="24" height="24" viewBox="0 0 24 24">
                  <path
                    d="M24 12 L4 12 L10 6 M4 12 L10 18"
                    stroke="white"
                    stroke-width="2.5"
                    fill="none"
                    stroke-linecap="round"
                    stroke-linejoin="round"></path>
                </svg>
              </div>
            </div>
          </div>

          <!-- Mobile: No arrow, centered -->
          <div
            class="sm:hidden absolute top-20 left-1/2 -translate-x-1/2 px-4 w-full max-w-xs pointer-events-auto"
          >
            <div class="bg-white rounded-xl shadow-2xl p-6">
              <div class="text-center">
                <div
                  class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-accent-primary/10 mb-3"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 text-accent-primary"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                  </svg>
                </div>
                <h3 class="text-lg font-semibold text-primary mb-2">
                  Tap ☰ to explore
                </h3>
                <p class="text-sm text-secondary leading-relaxed mb-4">
                  Open the menu to view different sections
                </p>
                <button class="close-onboarding btn btn-primary w-full"
                  >Got it</button
                >
              </div>
            </div>
          </div>
        </div>
        <!-- Desktop Hint Banner -->
        <div
          class="desktop-hint hidden sm:block bg-accent-primary/5 border-b border-accent-primary/20 px-6 py-2"
        >
          <p
            class="text-xs text-accent-primary text-center italic flex items-center justify-center gap-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-3.5 w-3.5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
              ></path>
            </svg>
            Click navigation on the left to explore different sections
          </p>
        </div>

        <!-- App Layout -->
        <div class="app-layout flex">
          <!-- Sidebar Navigation -->
          <aside
            class="sidebar hidden sm:flex flex-col w-56 bg-surface-dark border-r border-border/20"
          >
            <div class="sidebar-header px-4 py-5 border-b border-border/20">
              <div class="flex items-center gap-2">
                <div
                  class="w-7 h-7 rounded bg-accent-primary flex items-center justify-center"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4 text-inverse"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                    ></path>
                  </svg>
                </div>
                <span class="text-sm font-semibold text-inverse"
                  >Return Signals</span
                >
              </div>
            </div>

            <nav class="sidebar-nav flex-1 px-3 py-4 space-y-1 pt-6">
              <button data-view="overview" class="nav-item active">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                  ></path>
                </svg>
                Overview
              </button>
              <button data-view="interventions" class="nav-item">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
                  ></path>
                </svg>
                Interventions
              </button>
              <button data-view="products" class="nav-item">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
                  ></path>
                </svg>
                Products
              </button>
              <button data-view="configuration" class="nav-item">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                  ></path>
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                Configuration
              </button>
            </nav>

            <div class="sidebar-footer px-3 py-4 border-t border-border/20">
              <div class="flex items-center gap-2 px-3 py-2">
                <div
                  class="w-8 h-8 rounded-full bg-accent-primary/20 flex items-center justify-center"
                >
                  <span class="text-xs font-semibold text-inverse">JD</span>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-xs font-medium text-inverse truncate">
                    Jane Doe
                  </p>
                  <p class="text-xs text-inverse/50 truncate">Admin</p>
                </div>
              </div>
            </div>
          </aside>

          <!-- Main Content -->
          <div class="main-content flex-1 flex flex-col bg-surface-base">
            <!-- Mobile Hint -->
            <div
              class="mobile-hint sm:hidden bg-accent-primary/5 border-b border-accent-primary/20 px-4 py-2"
            >
              <p
                class="text-xs text-accent-primary text-center italic flex items-center justify-center gap-2"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-3.5 w-3.5 flex-shrink-0"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                  ></path>
                </svg>
                Tap ☰ to explore different sections
              </p>
            </div>

            <!-- Top Bar -->
            <div
              class="top-bar bg-surface-base border-b border-border px-4 sm:px-6 py-3"
            >
              <div class="flex items-center justify-between gap-4">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                  <button
                    class="mobile-menu-button sm:hidden p-2 -ml-2 text-primary hover:bg-surface-subtle rounded transition-colors"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                  </button>
                  <div class="flex-1 min-w-0">
                    <h1
                      class="view-title text-lg font-semibold text-primary mb-0.5"
                    >
                      Overview
                    </h1>
                    <p class="view-subtitle text-xs text-secondary">
                      Prevention • Intervention • Insights
                    </p>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <button
                    class="filter-btn flex items-center gap-2 px-3 py-1.5 text-xs font-medium text-secondary bg-surface-subtle border border-border rounded hover:bg-surface-elevated transition-colors"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-3.5 w-3.5"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                      ></path>
                    </svg>
                    <span class="hidden sm:inline">Last 30 Days</span>
                  </button>
                  <button
                    class="filter-btn flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-secondary bg-surface-subtle border border-border rounded hover:bg-surface-elevated transition-colors"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-3.5 w-3.5"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                      ></path>
                    </svg>
                    <span class="hidden sm:inline">Export</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Views Container -->
            <div
              class="views-container p-4 sm:p-6 flex-1 overflow-y-auto relative"
            >
              <div data-view-content="overview" class="view-content active">
                <OverviewView />
              </div>
              <div data-view-content="interventions" class="view-content">
                <InterventionsView />
              </div>
              <div data-view-content="products" class="view-content">
                <ProductsView />
              </div>
              <div data-view-content="configuration" class="view-content">
                <ConfigurationView />
              </div>
            </div>
          </div>

          <!-- Mobile Navigation Drawer -->
          <div
            class="mobile-nav-overlay sm:hidden fixed inset-0 bg-black/50 z-50 opacity-0 pointer-events-none transition-opacity duration-300"
          >
            <div
              class="mobile-nav-drawer absolute left-0 top-0 bottom-0 w-64 bg-surface-dark transform -translate-x-full transition-transform duration-300"
            >
              <div
                class="px-4 py-5 border-b border-border/20 flex items-center justify-between"
              >
                <div class="flex items-center gap-2">
                  <div
                    class="w-7 h-7 rounded bg-accent-primary flex items-center justify-center"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4 text-inverse"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                      ></path>
                    </svg>
                  </div>
                  <span class="text-sm font-semibold text-inverse"
                    >Return Signals</span
                  >
                </div>
                <button
                  class="mobile-nav-close p-1 text-inverse/60 hover:text-inverse"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>

              <div class="px-4 py-3 border-b border-border/20">
                <p class="text-xs text-inverse/40 italic text-center">
                  Tap any section to explore
                </p>
              </div>

              <nav class="mobile-nav-menu px-3 py-4 space-y-1">
                <button
                  data-view="overview"
                  class="nav-item mobile-nav-item active"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                    ></path>
                  </svg>
                  Overview
                </button>
                <button
                  data-view="interventions"
                  class="nav-item mobile-nav-item"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
                    ></path>
                  </svg>
                  Interventions
                </button>
                <button data-view="products" class="nav-item mobile-nav-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
                    ></path>
                  </svg>
                  Products
                </button>
                <button
                  data-view="configuration"
                  class="nav-item mobile-nav-item"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                    ></path>
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  Configuration
                </button>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    .analytics-platform-section {
      position: relative;
    }

    .app-layout {
      height: 650px;
    }

    .main-content {
      max-height: 650px;
    }

    .sidebar {
      background: linear-gradient(
        180deg,
        rgb(15, 23, 42) 0%,
        rgb(30, 41, 59) 100%
      );
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 0.75rem;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      user-select: none;
      transition: all 150ms ease-out;
      width: 100%;
      text-align: left;
    }

    .nav-item.active {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-weight: 500;
    }

    .nav-item:not(.active):hover {
      color: white;
      background: rgba(255, 255, 255, 0.05);
    }

    .filter-btn {
      cursor: default;
      user-select: none;
    }

    .views-container {
      background: #ffffff;
      overflow-y: auto;
      max-height: calc(650px - 60px);
    }

    .views-container::-webkit-scrollbar {
      width: 8px;
    }

    .views-container::-webkit-scrollbar-track {
      background: #ffffff;
    }

    .views-container::-webkit-scrollbar-thumb {
      background: rgb(203, 213, 225);
      border-radius: 4px;
    }

    .views-container::-webkit-scrollbar-thumb:hover {
      background: rgb(148, 163, 184);
    }

    .view-content {
      display: none;
      opacity: 0;
      animation: fadeIn 300ms ease-out forwards;
    }

    .view-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Mobile Navigation */
    .mobile-nav-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .mobile-nav-overlay.active .mobile-nav-drawer {
      transform: translateX(0);
    }

    .mobile-nav-drawer {
      box-shadow: 2px 0 12px rgba(0, 0, 0, 0.3);
      background: linear-gradient(
        180deg,
        rgb(15, 23, 42) 0%,
        rgb(30, 41, 59) 100%
      );
    }

    /* Onboarding overlay */
    .onboarding-overlay {
      transition: opacity 300ms ease-out;
    }

    .onboarding-overlay .bg-white {
      animation: slideIn 400ms ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @media (max-width: 640px) {
      .app-layout {
        height: 550px;
      }

      .main-content {
        max-height: 550px;
      }

      .views-container {
        max-height: calc(550px - 60px);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .nav-item,
      .view-content {
        transition: none !important;
        animation: none !important;
      }
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const containers = Array.from(
        document.querySelectorAll(".analytics-platform-section"),
      );

      const viewTitles = {
        overview: {
          title: "Overview",
          subtitle: "Prevention • Impact • Insights",
        },
        interventions: {
          title: "Interventions",
          subtitle: "Check-ins • Resolutions • Outcomes",
        },
        products: {
          title: "Products",
          subtitle: "SKU-level Intelligence • Trends",
        },
        configuration: {
          title: "Configuration",
          subtitle: "Brand Voice • Policies • Settings",
        },
      };

      function switchView(container: HTMLElement, viewName: string) {
        // Update nav active states (desktop)
        const navItems = Array.from(
          container.querySelectorAll(".nav-item"),
        ) as HTMLElement[];
        navItems.forEach((item) => {
          const itemView = item.getAttribute("data-view");
          if (itemView === viewName) {
            item.classList.add("active");
          } else {
            item.classList.remove("active");
          }
        });

        // Update view content
        const viewContents = Array.from(
          container.querySelectorAll(".view-content"),
        ) as HTMLElement[];
        viewContents.forEach((content) => {
          const contentView = content.getAttribute("data-view-content");
          if (contentView === viewName) {
            content.classList.add("active");
          } else {
            content.classList.remove("active");
          }
        });

        // Update top bar title
        const viewTitle = container.querySelector(".view-title") as HTMLElement;
        const viewSubtitle = container.querySelector(
          ".view-subtitle",
        ) as HTMLElement;
        if (viewTitle && viewTitles[viewName as keyof typeof viewTitles]) {
          viewTitle.textContent =
            viewTitles[viewName as keyof typeof viewTitles].title;
        }
        if (viewSubtitle && viewTitles[viewName as keyof typeof viewTitles]) {
          viewSubtitle.textContent =
            viewTitles[viewName as keyof typeof viewTitles].subtitle;
        }
      }

      containers.forEach((containerEl) => {
        const container = containerEl as HTMLElement;

        // Add click handlers to nav items
        const navItems = Array.from(
          container.querySelectorAll(".nav-item[data-view]"),
        ) as HTMLElement[];

        navItems.forEach((navItem) => {
          navItem.addEventListener("click", () => {
            const viewName = navItem.getAttribute("data-view");
            if (viewName) {
              switchView(container, viewName);

              // Close mobile menu if open
              const mobileOverlay = container.querySelector(
                ".mobile-nav-overlay",
              ) as HTMLElement;
              if (mobileOverlay) {
                mobileOverlay.classList.remove("active");
              }
            }
          });
        });

        // Mobile menu toggle
        const mobileMenuButton = container.querySelector(
          ".mobile-menu-button",
        ) as HTMLElement;
        const mobileOverlay = container.querySelector(
          ".mobile-nav-overlay",
        ) as HTMLElement;
        const mobileNavClose = container.querySelector(
          ".mobile-nav-close",
        ) as HTMLElement;

        if (mobileMenuButton && mobileOverlay) {
          mobileMenuButton.addEventListener("click", () => {
            mobileOverlay.classList.add("active");
          });
        }

        if (mobileNavClose && mobileOverlay) {
          mobileNavClose.addEventListener("click", () => {
            mobileOverlay.classList.remove("active");
          });
        }

        if (mobileOverlay) {
          mobileOverlay.addEventListener("click", (e) => {
            if (e.target === mobileOverlay) {
              mobileOverlay.classList.remove("active");
            }
          });
        }

        // Set initial view
        switchView(container, "overview");
      });

      // Onboarding overlay logic
      const onboardingOverlay = document.getElementById("analytics-onboarding");
      const closeButtons = document.querySelectorAll(".close-onboarding");

      // Check if user has seen the onboarding
      const hasSeenOnboarding = localStorage.getItem(
        "analytics-onboarding-seen",
      );

      if (hasSeenOnboarding) {
        // Hide overlay if already seen
        if (onboardingOverlay) {
          onboardingOverlay.style.display = "none";
        }
      }

      // Close overlay and save preference
      closeButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          if (onboardingOverlay) {
            onboardingOverlay.style.opacity = "0";
            setTimeout(() => {
              onboardingOverlay.style.display = "none";
            }, 300);
          }
          localStorage.setItem("analytics-onboarding-seen", "true");
        });
      });

      // Also close when clicking the overlay background
      if (onboardingOverlay) {
        onboardingOverlay.addEventListener("click", (e) => {
          if (e.target === onboardingOverlay) {
            onboardingOverlay.style.opacity = "0";
            setTimeout(() => {
              onboardingOverlay.style.display = "none";
            }, 300);
            localStorage.setItem("analytics-onboarding-seen", "true");
          }
        });
      }
    });
  </script>
</section>
