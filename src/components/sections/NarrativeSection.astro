---
/**
 * NarrativeSection
 *
 * Reusable section for customer narratives (Jacky, Bob, Priya)
 * Features SMS mockup + narrative image in two-column layout
 */

import SMSMockup from '@components/ui/SMSMockup.astro'
import NarrativeImage from '@components/ui/NarrativeImage.astro'

interface Message {
  type: 'incoming' | 'outgoing'
  content?: 'text' | 'image' // defaults to 'text'
  text?: string
  imageSrc?: string
  imageAlt?: string
  timestamp?: string
}

interface Props {
  header: string
  story: string
  messages: Message[]
  narrativeImage: string
  narrativeImageAlt: string
  callout?: string
  className?: string
  id?: string
  phoneOnLeft?: boolean // If true, phone is on left; if false, image is on left
}

const {
  header,
  story,
  messages,
  narrativeImage,
  narrativeImageAlt,
  callout,
  className = '',
  id,
  phoneOnLeft = true,
} = Astro.props
---

<section {id} class={`bg-surface-base py-12 sm:py-16 ${className}`}>
  <div class="container-lg">
    <!-- Scrub zone: title + content pin together with fixed spacing -->
    <div
      class="sms-scrub-zone relative max-w-6xl mx-auto"
      style={`--title-offset: 72px; --title-gap: 48px; --sms-steps: ${messages.length}; --sms-step: 24px; --sms-hold: 24px; min-height: calc(100vh + var(--sms-step) * var(--sms-steps) + var(--sms-hold));`}
    >
      <div class="sticky top-0">
        <!-- Spacer to position title below top -->
        <div style="height: var(--title-offset)"></div>
        <h2 class="text-2xl sm:text-3xl lg:text-5xl font-semibold text-primary text-center max-w-4xl mx-auto">
          {header}
        </h2>
        <div class="mt-[var(--title-gap)] grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-3 items-center">
          <!-- SMS Mockup (pinned) -->
          <div class={`order-2 ${phoneOnLeft ? 'lg:order-1' : 'lg:order-2'}`}>
            <SMSMockup {messages} />
          </div>

          <!-- Narrative Image (pinned) -->
          <div class={`order-1 ${phoneOnLeft ? 'lg:order-2' : 'lg:order-1'}`}>
            <NarrativeImage src={narrativeImage} alt={narrativeImageAlt} story={story} />
          </div>
        </div>
      </div>
    </div>

    {
      callout && (
        <div class="mt-12 max-w-3xl mx-auto text-center animate-on-scroll">
          <p class="text-sm text-tertiary italic font-light">{callout}</p>
        </div>
      )
    }
  </div>
</section>

