---
/**
 * Analytics Stage 1: Top Return Reasons
 *
 * Displays top 3-5 return reasons with:
 * - Animated counting numbers
 * - Bar chart fills
 * - Percentages
 */

interface Reason {
  label: string;
  count: number;
  percentage: number;
}

interface Props {
  reasons: Reason[];
  totalReturns: number;
  dateRange: string;
  className?: string;
}

const { reasons, totalReturns, dateRange, className = "" } = Astro.props;
---

<div class={`analytics-stage-1 ${className}`} data-stage="1">
  <div class="stage-header mb-6">
    <h3 class="text-lg sm:text-xl font-semibold text-primary mb-1">
      Outcomes Overview
    </h3>
    <p class="text-sm text-secondary">{dateRange} â€¢ 2,000 check-ins</p>
  </div>

  <div class="reasons-list space-y-4">
    {
      reasons.map((reason, index) => (
        <div class="reason-item" data-reason-index={index}>
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-2">
              <span class="reason-rank text-sm font-semibold text-tertiary">
                {index + 1}.
              </span>
              <span class="reason-label text-base font-medium text-primary">
                {reason.label}
              </span>
            </div>
            <div class="flex items-center gap-3">
              <span
                class="count-animated text-lg font-bold text-primary"
                data-target={reason.count}
              >
                0
              </span>
              <span class="percentage text-sm text-secondary">
                {reason.percentage}%
              </span>
            </div>
          </div>
          <div class="bar-container h-2 bg-surface-elevated rounded-full overflow-hidden">
            <div
              class="bar-fill h-full bg-accent-primary rounded-full"
              data-width={`${reason.percentage}%`}
              style="width: 0%; will-change: width;"
            />
          </div>
        </div>
      ))
    }
  </div>

  <div class="total-summary mt-6 pt-4 border-t border-subtle">
    <div class="flex items-center justify-between">
      <span class="text-base font-medium text-secondary">Total Returns:</span>
      <span
        class="count-animated text-xl font-bold text-primary"
        data-target={totalReturns}
      >
        0
      </span>
    </div>
  </div>
</div>

<style>
  .analytics-stage-1 {
    opacity: 0;
    transform: translateY(10px);
    transition:
      opacity 400ms ease-out,
      transform 400ms ease-out;
  }

  .analytics-stage-1.stage-active {
    opacity: 1;
    transform: translateY(0);
  }

  .analytics-stage-1.stage-fading-out {
    opacity: 0;
    transition:
      opacity 800ms ease-out,
      transform 800ms ease-out;
  }

  .reason-item {
    opacity: 0;
    transform: translateY(5px);
    transition:
      opacity 300ms ease-out,
      transform 300ms ease-out;
  }

  .reason-item.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  @media (prefers-reduced-motion: reduce) {
    .analytics-stage-1,
    .reason-item {
      transition: none !important;
      opacity: 1 !important;
      transform: none !important;
    }

    .bar-fill {
      transition: none !important;
    }
  }
</style>
