---
/**
 * Analytics Stage 3: Natural Language Query
 *
 * Displays natural language query interface with:
 * - Typing animation in search input
 * - Answer card slide-up
 * - Staggered item reveals
 */

interface AnswerItem {
  label: string;
  value: string;
}

interface Props {
  question: string;
  answer: {
    summary: string;
    items: AnswerItem[];
  };
  className?: string;
}

const { question, answer, className = "" } = Astro.props;
---

<div class={`analytics-stage-3 ${className}`} data-stage="3">
  <div class="stage-header mb-6">
    <h3 class="text-lg sm:text-xl font-semibold text-primary mb-1">
      Product Intelligence
    </h3>
    <p class="text-sm text-secondary">
      SKU-level insights from customer check-ins
    </p>
  </div>

  <!-- Search Bar -->
  <div class="nl-search-container mb-6">
    <div
      class="nl-search-bar relative bg-surface-base border-2 border-accent-primary/30 rounded-lg shadow-sm focus-within:border-accent-primary transition-colors"
    >
      <input
        type="text"
        readonly
        class="nl-input w-full px-4 py-3 pr-12 text-base text-primary bg-transparent outline-none cursor-default"
        value=""
        data-full-text={question}
        placeholder="Ask a question..."
      />
      <div
        class="search-icon absolute right-3 top-1/2 -translate-y-1/2 text-accent-primary"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>
    </div>
  </div>

  <!-- Answer Card -->
  <div
    class="nl-answer-card bg-surface-subtle border border-border rounded-lg p-6"
  >
    <div class="answer-header flex items-start gap-2 mb-4">
      <div
        class="icon-feature w-8 h-8 rounded-lg bg-accent-primary/10 flex items-center justify-center flex-shrink-0"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-4 w-4 text-accent-primary"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          ></path>
        </svg>
      </div>
      <div class="flex-1">
        <h4 class="text-sm font-semibold text-accent-primary mb-1">Answer</h4>
      </div>
    </div>

    <div class="answer-content">
      <p class="text-base text-primary mb-4">{answer.summary}</p>

      <ul class="answer-list space-y-3">
        {
          answer.items.map((item, index) => (
            <li
              class="answer-item flex items-start gap-3 opacity-0"
              data-item-index={index}
            >
              <span class="flex-shrink-0 w-1.5 h-1.5 rounded-full bg-accent-primary mt-2" />
              <div class="flex-1">
                <span class="text-base text-primary font-medium">
                  {item.label}
                </span>
                <span class="text-secondary"> â€” {item.value}</span>
              </div>
            </li>
          ))
        }
      </ul>
    </div>
  </div>
</div>

<style>
  .analytics-stage-3 {
    opacity: 0;
    transform: translateY(10px);
    transition:
      opacity 400ms ease-out,
      transform 400ms ease-out;
  }

  .analytics-stage-3.stage-active {
    opacity: 1;
    transform: translateY(0);
  }

  .analytics-stage-3.stage-fading-out {
    opacity: 0;
    transition:
      opacity 800ms ease-out,
      transform 800ms ease-out;
  }

  .nl-search-bar {
    transform: scale(0.98);
    transition:
      transform 200ms ease-out,
      border-color 200ms ease-out;
  }

  .nl-search-bar.is-visible {
    transform: scale(1);
  }

  .nl-answer-card {
    opacity: 0;
    transform: translateY(20px);
    transition:
      opacity 400ms ease-out,
      transform 400ms ease-out;
  }

  .nl-answer-card.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .answer-item {
    transition:
      opacity 300ms ease-out,
      transform 300ms ease-out;
    transform: translateX(-10px);
  }

  .answer-item.is-visible {
    opacity: 1 !important;
    transform: translateX(0);
  }

  /* Typing cursor effect */
  .nl-input.typing::after {
    content: "|";
    animation: blink 1s step-end infinite;
    margin-left: 2px;
  }

  @keyframes blink {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .analytics-stage-3,
    .nl-search-bar,
    .nl-answer-card,
    .answer-item {
      transition: none !important;
      opacity: 1 !important;
      transform: none !important;
    }

    .nl-input.typing::after {
      animation: none;
    }
  }
</style>
