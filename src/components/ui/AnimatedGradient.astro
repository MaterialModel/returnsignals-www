---
// AnimatedGradient component
// Provides a slow, ambient gradient animation with subtle parallax for an enterprise feel
// Respects prefers-reduced-motion for accessibility
---

<div class="animated-gradient-bg" aria-hidden="true"></div>

<style>
  .animated-gradient-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 110%; /* Slightly larger for parallax movement */
    z-index: -10;

    /* Light gradient with more noticeable variation */
    background: linear-gradient(
      135deg,
      rgb(226, 232, 240) 0%,
      /* slate-200 */ rgb(241, 245, 249) 20%,
      /* slate-100 */ rgb(248, 250, 252) 40%,
      /* slate-50 */ rgb(255, 255, 255) 50%,
      /* white */ rgb(248, 250, 252) 60%,
      /* slate-50 */ rgb(241, 245, 249) 80%,
      /* slate-100 */ rgb(226, 232, 240) 100% /* slate-200 */
    );

    /* Animated gradient overlay */
    background-size: 400% 400%;
    animation: gradientShift 25s ease infinite;

    /* Enable hardware acceleration for parallax */
    will-change: transform;
    transform: translate3d(0, 0, 0);
  }

  @keyframes gradientShift {
    0% {
      background-position: 0% 50%;
    }
    25% {
      background-position: 50% 60%;
    }
    50% {
      background-position: 100% 50%;
    }
    75% {
      background-position: 50% 40%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  /* Respect user's motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .animated-gradient-bg {
      animation: none;
      background-position: 0% 50%;
      background-size: 100% 100%;
    }
  }

  /* Add subtle noise texture for depth */
  .animated-gradient-bg::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.05;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    pointer-events: none;
  }
</style>

<script>
  // Subtle parallax effect on scroll
  const parallaxFactor = 0.04; // Very subtle movement
  const parallaxMaxOffset = 100; // Max 100px movement

  function initParallax() {
    const bg = document.querySelector(".animated-gradient-bg") as HTMLElement;
    if (!bg) return;

    // Check for reduced motion preference
    const prefersReducedMotion = window.matchMedia(
      "(prefers-reduced-motion: reduce)",
    ).matches;
    if (prefersReducedMotion) return;

    let ticking = false;

    const onScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          const y = window.scrollY || 0;
          // Move background UP as we scroll down (negative offset) for proper parallax
          const offset = Math.max(
            -parallaxMaxOffset,
            Math.min(parallaxMaxOffset, -(y * parallaxFactor)),
          );
          bg.style.transform = `translate3d(0, ${offset}px, 0)`;
          ticking = false;
        });
        ticking = true;
      }
    };

    window.addEventListener("scroll", onScroll, { passive: true });
  }

  // Initialize on load and on Astro page transitions
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initParallax);
  } else {
    initParallax();
  }

  // Re-initialize on Astro view transitions (if enabled in the future)
  document.addEventListener("astro:page-load", initParallax);
</script>
